<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hash file(s) demo</title>

    <!-- IE ZONE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <script type="text/javascript">
        if (/MSIE \d|Trident.*rv:/.test(navigator.userAgent))
            document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/bluebird/3.3.5/bluebird.min.js"><\/script>');
    </script>
    <!-- END IE ZONE -->

    <!-- Woleet web libs (regular version) -->
    <script>woleet = {workerScriptPath: '../dist/woleet-hashfile-worker.js'}</script>
    <script src="../dist/woleet-crypto.js"></script>
    <script src="../dist/woleet-hashfile.js"></script>

    <!-- Woleet web libs (minified version) -->
    <!--<script src="../dist/woleet-weblibs.min.js"></script>-->

    <script>
        window.onload = function () {

            // Instantiate a new file hasher
            let hasher = new woleet.file.Hasher;
            let li = null;
            window.hasher = hasher;

            window.start = function (files) {
                // This transformation is for testing purpose only
                // we could pass directly "files" as it is a FileList object
                let arr = [];
                for (let i = 0; i < files.length; i++) arr.push(files[i]);

                try {
                    hasher.start(arr);
                } catch (err) {
                    console.warn(err);
                }
            };

            hasher.on('start', function (message) {
                console.log(message);
                li = document.createElement("li");
                document.getElementById('hashes').appendChild(li);
                li.innerText = message.file.name + ': started';
                console.time('hash');
            });
            hasher.on('progress', function (message) {
                console.log(message);
                li.innerText = message.file.name + ': ' + (message.progress).toFixed(2) + '%';
            });
            hasher.on('error', function (error) {
                console.error(error);
            });
            hasher.on('cancel', function (message) {
                li.innerText = message.file.name + ': cancelled';
            });
            hasher.on('skip', function (message) {
                li.innerText = message.file.name + ': skipped';
            });
            // On success, display computed hash
            hasher.on('result', function (message) {
                console.log(message);
                console.timeEnd('hash');
                li.innerText = message.file.name + ': ' + message.result;
            });
        }
    </script>
</head>
<body>
<h3>Hash file(s) demo</h3>
<input type="file" id="input" multiple onchange="start(this.files)">
<button onclick="hasher.cancel()">Cancel</button>
<button onclick="hasher.skip()">Skip</button>
<ul id="hashes"></ul>
</body>
</html>